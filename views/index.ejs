<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
        crossorigin="anonymous">
    <title>URL Shortner</title>
    <style type="text/css">
		* {
			margin:0px;
			padding: 0px;
			box-sizing: border-box;
		}
		body {
			font-family:"Raleway",sans-serif;
		}
		.header {
			width:100%;
			height:50px;
			line-height: 50px;
			text-align: center;
			background: #111;
			color: #eee;
			font-weight: 600;
		}
		.form {
			padding:50px 20px;
			background:#d2e9f7;
		}
		.form > div {
			width:400px;
			margin:10px auto;
		}
		.form .form-element input,
		.form .form-element button {
			width:100%;
			padding: 10px;
			margin-top: 10px;
		}
		.form .form-element button {
			background: #111;
			color:#eee;
			outline: none;
			border:none;
			cursor: pointer;
		}
		.form .result {
			text-align: center;
			border-top:1px solid #eee;
			margin-top:5px;
		}
		.list {
			width:800px;
			margin:40px auto;
		}
		.list h2 {
			font-size: 40px;
			margin-bottom: 20px;
		}
		.list table {
			width:100%;
			text-align: center;
		}
		.list table thead tr {
			background: #555;
			color:#eee;
		}
		.list table thead tr th,
		.list table tbody tr td {
			padding:5px;
		}
		.list table tbody tr:nth-child(odd){
			background: #eee;
		}
		.error-message{
			width: auto;
			height: auto;
			padding: 4px;
			text-align: center;
			background-color: #ff3333;
		}
		#close-error{
			width: 30px;
			height: 20px;
			float: right;
			color: white;
			text-align: center;
			font-weight: bolder;
			cursor: pointer;
			transition:ease-in-out 0.4s;
			display: block;

		}
		#close-error:hover{
			transition:ease-in-out 0.2s;
			transform: rotate(90deg);
		}
	</style>
</head>
<body>
    <div class="header">
        URL Shortner
    </div>
	<% if (locals.data.errorMessage){ %> 
		<div class ="error-message">
			<div id="close-error"> 
				X
			</div>
			<%= locals.data.errorMessage.message %> 
		</div>
	<% } %> 
    <form action="/shorten", method="POST">
        <div class="form">
            <div class="form-element">
                <label for="longurl">Enter link</label>
                <input type="url" id="longurl" name="userUrl" placeholder="http://site.com" value="<%= locals.data.originalUrl %> ">
            </div>
            <div class="result">
				<p>Short Link:
					<a href="<%= locals.data.originalUrl %>" id="short-url" target="_blank"> 
						<%= locals.data.shortUrl %>
					</a>
				</p>
			</div>
            <div class="form-element">
                <button type="submit" id="create-short-url">Create Short URL</button>
            </div>
        </div>
    </form>
        
    
    <div class="list">
        <h2>Shorten links</h2>
        <table id="list_urls">
            <thead>
                <tr>
                    <th>LongURL</th>
                    <th>ShortURL</th>
                    <th>UrlKey</th>
                </tr>
            </thead>
            <tbody>
                <% for(let i = 0; i<data.rows.length; i++){ %>
                    <tr>
                        <td>
                            <%= data.rows[i].OriginalUrl %>
                        </td>
                        <td>
                            <%= data.rows[i].ShortenUrl %>
                        </td>
                        <td>
                            <%= data.rows[i].UrlKey %>
                        </td>
                    </tr>
                <% } %>
            </tbody>
        </table>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous">
    </script> 
    
    <script>
        const errorCrossBtn = document.querySelector('#close-error');
		const errorMsg = document.querySelector('.error-message');
        errorCrossBtn.addEventListener("click", () =>{
            errorMsg.style.display = "none";
			console.log("I am here", errorMsg);
        });
        
    </script>
    
</body>
</html>